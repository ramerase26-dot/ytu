<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¡ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
            text-align: center;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto 40px;
        }
        
        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 10px solid #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        
        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .pointer {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 60px;
            background: #FF0000;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            z-index: 10;
            filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.7));
        }
        
        .spin-btn {
            background: linear-gradient(135deg, #FF416C, #FF4B2B);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.4);
        }
        
        .spin-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 65, 108, 0.6);
        }
        
        .spin-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            font-size: 1.8rem;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border-left: 5px solid #FFD700;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .prizes-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        .prize-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .prize-amount {
            font-size: 1.4rem;
            font-weight: bold;
            color: #FFD700;
        }
        
        .prize-percent {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .loading {
            display: none;
            font-size: 1.2rem;
            margin: 20px 0;
        }
        
        @media (max-width: 600px) {
            .wheel-container {
                width: 300px;
                height: 300px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¡ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h1>
        <div class="subtitle">Ù‚Ù… Ø¨ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© ÙˆØ§Ø±Ø¨Ø­ Ø¬ÙˆØ§Ø¦Ø² Ù…Ø°Ù‡Ù„Ø©!</div>
        
        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="wheel" width="400" height="400"></canvas>
        </div>
        
        <button id="spinBtn" class="spin-btn">ğŸ¡ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø©</button>
        
        <div id="loading" class="loading">
            â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©...
        </div>
        
        <div id="result" class="result"></div>
        
        <div class="prizes-list">
            <div class="prize-item">
                <div class="prize-amount">5,000</div>
                <div class="prize-percent">5% ÙØ±ØµØ©</div>
            </div>
            <div class="prize-item">
                <div class="prize-amount">10,000</div>
                <div class="prize-percent">10% ÙØ±ØµØ©</div>
            </div>
            <div class="prize-item">
                <div class="prize-amount">5,000</div>
                <div class="prize-percent">2% ÙØ±ØµØ©</div>
            </div>
            <div class="prize-item">
                <div class="prize-amount">100,000</div>
                <div class="prize-percent">20% ÙØ±ØµØ©</div>
            </div>
            <div class="prize-item">
                <div class="prize-amount">0</div>
                <div class="prize-percent">10% ÙØ±ØµØ©</div>
            </div>
            <div class="prize-item">
                <div class="prize-amount">500,000</div>
                <div class="prize-percent">43% ÙØ±ØµØ©</div>
            </div>
            <div class="prize-item">
                <div class="prize-amount">1,000,000</div>
                <div class="prize-percent">20% ÙØ±ØµØ©</div>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const userId = new URLSearchParams(window.location.search).get('user_id') || 'unknown';
        const telegramBotToken = '8497054736:AAF_EcYGx5UuEMdRbaYZz8zRCCkVYBwPHq4'; // Token Ø§Ù„Ø¨ÙˆØª
        const googleScriptURL = 'https://script.google.com/macros/s/AKfycbw5u_sWiJj33RPh-7ppBADqJFpEmdw5p55SFRR3vVo5Rgk4NgDgf2-3ZxNL20LGNIwgkQ/exec'; // Ø±Ø§Ø¨Ø· Google Script
        
        // Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ù…Ø¹ Ù†Ø³Ø¨Ù‡Ø§
        const prizes = [
            { amount: 5000, percent: 5, color: '#FF6384', label: '5,000' },
            { amount: 10000, percent: 10, color: '#36A2EB', label: '10,000' },
            { amount: 5000, percent: 2, color: '#FFCE56', label: '5,000' },
            { amount: 100000, percent: 20, color: '#4BC0C0', label: '100,000' },
            { amount: 0, percent: 10, color: '#9966FF', label: '0' },
            { amount: 500000, percent: 43, color: '#FF9F40', label: '500,000' },
            { amount: 1000000, percent: 20, color: '#FF6384', label: '1,000,000' }
        ];
        
        // Ø­Ø³Ø§Ø¨ Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ù‚Ø·Ø¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨
        let currentRotation = 0;
        let isSpinning = false;
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spinBtn');
        const resultDiv = document.getElementById('result');
        const loadingDiv = document.getElementById('loading');
        
        // Ø±Ø³Ù… Ø§Ù„Ø¹Ø¬Ù„Ø©
        function drawWheel() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 10;
            let startAngle = 0;
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ø³Ø¨
            const totalPercent = prizes.reduce((sum, prize) => sum + prize.percent, 0);
            
            // Ø±Ø³Ù… ÙƒÙ„ Ù‚Ø·Ø¹Ø©
            prizes.forEach((prize, index) => {
                const sliceAngle = (prize.percent / totalPercent) * 2 * Math.PI;
                const endAngle = startAngle + sliceAngle;
                
                // Ø±Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fillStyle = prize.color;
                ctx.fill();
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†Øµ
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 16px Cairo';
                ctx.fillText(prize.label, radius - 20, 5);
                ctx.restore();
                
                startAngle = endAngle;
            });
            
            // Ø±Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²
            ctx.beginPath();
            ctx.arc(centerX, centerY, 20, 0, 2 * Math.PI);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // ÙƒØªØ§Ø¨Ø© "Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸" ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ²
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 14px Cairo';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ğŸ¡', centerX, centerY);
        }
        
        // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø©
        function spinWheel() {
            if (isSpinning) return;
            
            isSpinning = true;
            spinBtn.disabled = true;
            resultDiv.textContent = '';
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨
            const random = Math.random() * 100;
            let cumulativePercent = 0;
            let selectedPrize = null;
            let selectedIndex = 0;
            
            for (let i = 0; i < prizes.length; i++) {
                cumulativePercent += prizes[i].percent;
                if (random <= cumulativePercent) {
                    selectedPrize = prizes[i];
                    selectedIndex = i;
                    break;
                }
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù„Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            const totalPercent = prizes.reduce((sum, prize) => sum + prize.percent, 0);
            let prizeAngle = 0;
            for (let i = 0; i < selectedIndex; i++) {
                prizeAngle += (prizes[i].percent / totalPercent) * 360;
            }
            prizeAngle += (selectedPrize.percent / totalPercent) * 360 / 2;
            
            // Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø£Ù† ØªÙ‚Ù Ø¹Ù†Ø¯Ù‡Ø§ Ø§Ù„Ø¹Ø¬Ù„Ø© (Ø¨Ø­ÙŠØ« ØªÙƒÙˆÙ† Ø§Ù„Ù‚Ø·Ø¹Ø© ØªØ­Øª Ø§Ù„Ù…Ø¤Ø´Ø±)
            const targetRotation = 3600 - prizeAngle; // 3600 = 10 Ø¯ÙˆØ±Ø§Øª ÙƒØ§Ù…Ù„Ø©
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø±ÙƒØ©
            currentRotation += targetRotation;
            canvas.style.transform = `rotate(${currentRotation}deg)`;
            
            // Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ¯ÙˆÙŠØ±
            setTimeout(async () => {
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                resultDiv.textContent = `ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª ${selectedPrize.amount.toLocaleString()} Ù†Ù‚Ø·Ø©!`;
                resultDiv.style.color = selectedPrize.color;
                
                // Ø¥Ø¸Ù‡Ø§Ø± ØªØ­Ù…ÙŠÙ„
                loadingDiv.style.display = 'block';
                
                try {
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ Google
                    await recordToGoogleSheets(selectedPrize.amount);
                    
                    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª
                    await sendPrizeToTelegram(selectedPrize.amount);
                    
                    loadingDiv.textContent = 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ!';
                    
                    // ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
                    setTimeout(() => {
                        isSpinning = false;
                        spinBtn.disabled = false;
                        loadingDiv.style.display = 'none';
                    }, 5000);
                    
                } catch (error) {
                    console.error('Error:', error);
                    loadingDiv.textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                    setTimeout(() => {
                        isSpinning = false;
                        spinBtn.disabled = false;
                        loadingDiv.style.display = 'none';
                    }, 3000);
                }
            }, 4000);
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Google Sheets
        async function recordToGoogleSheets(amount) {
            const data = {
                user_id: userId,
                prize_amount: amount,
                timestamp: new Date().toISOString(),
                action: 'lucky_wheel_spin'
            };
            
            const response = await fetch(googleScriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            return response;
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¥Ù„Ù‰ Ø¨ÙˆØª Ø§Ù„ØªÙ„ØºØ±Ø§Ù…
        async function sendPrizeToTelegram(amount) {
            const message = `ğŸ¡ *Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸*\n\nğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª *${amount.toLocaleString()} Ù†Ù‚Ø·Ø©*!\n\nØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.`;
            
            // Ù‡Ù†Ø§ ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¶Ø§ÙØ© API endpoint ÙÙŠ Ø§Ù„Ø¨ÙˆØª Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©
            // Ù…Ø«Ø§Ù„: https://api.telegram.org/bot${telegramBotToken}/sendMessage?chat_id=${userId}&text=${encodeURIComponent(message)}
            
            // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø©: Ø§Ø³ØªØ®Ø¯Ø§Ù… webhook
            const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chat_id: userId,
                    text: message,
                    parse_mode: 'Markdown'
                })
            });
            
            return response.json();
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø£Ø­Ø¯Ø§Ø«
        spinBtn.addEventListener('click', spinWheel);
        
        // Ø±Ø³Ù… Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.onload = drawWheel;
        
        // Ø¹Ø±Ø¶ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØµØ­ÙŠØ­)
        console.log('User ID:', userId);
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (userId === 'unknown') {
            resultDiv.textContent = 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
            resultDiv.style.color = '#FF0000';
            spinBtn.disabled = true;
        }
    </script>
</body>
</html>
