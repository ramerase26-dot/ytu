<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ ğŸ¡</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461, #1e3799);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            text-align: center;
            max-width: 800px;
            width: 100%;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        h1 {
            color: #ffdd59;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            color: #d2dae2;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .wheel-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 0 auto 40px;
        }
        
        .wheel-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('https://i.postimg.cc/wB7MWQsq/IMG-20260129-003341-890.jpg') center/contain no-repeat;
            z-index: 1;
        }
        
        #wheelCanvas {
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }
        
        .spin-button {
            background: linear-gradient(45deg, #ff9f1a, #ff3838);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 56, 56, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .spin-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 56, 56, 0.6);
        }
        
        .spin-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }
        
        .result.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .prize-text {
            font-size: 1.8rem;
            color: #ffdd59;
            margin-bottom: 10px;
        }
        
        .prize-code {
            font-family: monospace;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
            margin: 10px 0;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }
        
        .loading {
            display: none;
            font-size: 1.2rem;
            color: #ffdd59;
            margin: 20px 0;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #ffdd59;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 550px) {
            .wheel-container {
                width: 350px;
                height: 350px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-dharmachakra"></i> Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h1>
            <p class="subtitle">Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø© ÙˆØ§Ø±Ø¨Ø­ Ø¬ÙˆØ§Ø¦Ø² Ù…Ø°Ù‡Ù„Ø©!</p>
        </div>
        
        <div class="user-info" id="userInfo">
            Ø¬Ø§Ù‡Ø² Ù„Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø©...
        </div>
        
        <div class="wheel-container">
            <div class="wheel-background"></div>
            <canvas id="wheelCanvas" width="500" height="500"></canvas>
        </div>
        
        <button id="spinButton" class="spin-button">
            <i class="fas fa-redo"></i> Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø©
        </button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©...
        </div>
        
        <div class="result" id="result">
            <h2 class="prize-text" id="prizeText"></h2>
            <p>Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ ÙØ²Øª Ø¨Ù€:</p>
            <div class="prize-code" id="prizeCode"></div>
            <p>Ø³ÙŠØµÙ„Ùƒ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ØªÙ„ØºØ±Ø§Ù… Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©</p>
        </div>
    </div>

    <script>
        // ============ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø¬Ù„Ø© ============
        const prizes = [
            { text: "5000", value: "5000", weight: 25, color: "#3498db" },
            { text: "10000", value: "10000", weight: 20, color: "#2ecc71" },
            { text: "5%", value: "5%", weight: 20, color: "#e74c3c" },
            { text: "100000", value: "100000", weight: 15, color: "#f39c12" },
            { text: "10%", value: "10%", weight: 10, color: "#9b59b6" },
            { text: "500000", value: "500000", weight: 7, color: "#1abc9c" },
            { text: "1000000", value: "1000000", weight: 3, color: "#e67e22" }
        ];

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„Ù…Ø§Øª URL
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id') || 'unknown';
        const username = urlParams.get('username') || 'Ù…Ø³ØªØ®Ø¯Ù…';
        const firstName = urlParams.get('first_name') || 'Ø¹Ø²ÙŠØ²ÙŠ';

        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('userInfo').innerHTML = `
            <i class="fas fa-user"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${firstName} (${username})<br>
            <i class="fas fa-history"></i> ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯ÙˆØ± Ù…Ø±Ø© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©
        `;

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø¬Ù„Ø©
        let canvas = document.getElementById('wheelCanvas');
        let ctx = canvas.getContext('2d');
        let centerX = canvas.width / 2;
        let centerY = canvas.height / 2;
        let radius = Math.min(centerX, centerY) - 20;
        let currentRotation = 0;
        let isSpinning = false;
        let spinButton = document.getElementById('spinButton');
        let resultDiv = document.getElementById('result');
        let prizeText = document.getElementById('prizeText');
        let prizeCode = document.getElementById('prizeCode');
        let loadingDiv = document.getElementById('loading');

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙˆØ²Ø§Ù†
        const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
        const segments = [];
        let currentAngle = 0;

        prizes.forEach(prize => {
            const segmentAngle = (prize.weight / totalWeight) * (2 * Math.PI);
            segments.push({
                ...prize,
                startAngle: currentAngle,
                endAngle: currentAngle + segmentAngle
            });
            currentAngle += segmentAngle;
        });

        // ============ Ø±Ø³Ù… Ø§Ù„Ø¹Ø¬Ù„Ø© ============
        function drawWheel(rotation = 0) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Ø±Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹
            segments.forEach(segment => {
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, 
                       segment.startAngle + rotation, 
                       segment.endAngle + rotation);
                ctx.closePath();
                
                ctx.fillStyle = segment.color;
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(segment.startAngle + rotation + (segment.endAngle - segment.startAngle) / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = 'white';
                ctx.font = 'bold 24px Arial';
                ctx.fillText(segment.text, radius - 30, 10);
                ctx.restore();
            });
            
            // Ø±Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²
            ctx.beginPath();
            ctx.arc(centerX, centerY, 20, 0, 2 * Math.PI);
            ctx.fillStyle = '#2c3e50';
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 4;
            ctx.stroke();
            
            // Ø±Ø³Ù… Ø§Ù„Ù…Ø¤Ø´Ø±
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - radius - 20);
            ctx.lineTo(centerX - 15, centerY - radius + 10);
            ctx.lineTo(centerX + 15, centerY - radius + 10);
            ctx.closePath();
            ctx.fillStyle = '#e74c3c';
            ctx.fill();
        }

        // ============ Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø¹Ø¬Ù„Ø© ============
        function spinWheel() {
            if (isSpinning) return;
            
            isSpinning = true;
            spinButton.disabled = true;
            resultDiv.classList.remove('show');
            
            // Ø¯ÙˆØ±Ø§Ù† Ø³Ø±ÙŠØ¹ Ø£ÙˆÙ„ÙŠ
            let spins = 5 + Math.random() * 3; // 5-8 Ø¯ÙˆØ±Ø§Øª
            let totalRotation = spins * 2 * Math.PI;
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù†
            let random = Math.random() * totalWeight;
            let selectedPrize;
            let cumulativeWeight = 0;
            
            for (let segment of segments) {
                cumulativeWeight += segment.weight;
                if (random <= cumulativeWeight) {
                    selectedPrize = segment;
                    break;
                }
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù„Ù„ØªÙˆÙ‚Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            let targetAngle = 2 * Math.PI - (selectedPrize.startAngle + 
                           (selectedPrize.endAngle - selectedPrize.startAngle) / 2);
            totalRotation += targetAngle;
            
            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
            let startTime = null;
            const duration = 5000; // 5 Ø«ÙˆØ§Ù†ÙŠ
            
            function animate(time) {
                if (!startTime) startTime = time;
                let elapsed = time - startTime;
                let progress = Math.min(elapsed / duration, 1);
                
                // Ø¯Ø§Ù„Ø© ØªÙˆÙ‚ÙŠÙ Ø³Ù‡Ù„Ø©
                let easing = 1 - Math.pow(1 - progress, 3);
                currentRotation = easing * totalRotation;
                
                drawWheel(currentRotation);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
                    setTimeout(() => {
                        showResult(selectedPrize);
                    }, 1000);
                }
            }
            
            requestAnimationFrame(animate);
        }

        // ============ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© ============
        function showResult(prize) {
            // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ ÙØ±ÙŠØ¯ Ù„Ù„Ø¬Ø§Ø¦Ø²Ø©
            const prizeCodeValue = 'PRIZE-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            
            prizeText.textContent = prize.text;
            prizeCode.textContent = prizeCodeValue;
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ù„Ù‰ Google Apps Script
            sendToGoogleSheet(prize, prizeCodeValue);
        }

        // ============ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© ============
        function sendToGoogleSheet(prize, prizeCodeValue) {
            loadingDiv.classList.add('show');
            
            const data = {
                user_id: userId,
                username: username,
                first_name: firstName,
                prize: prize.text,
                prize_value: prize.value,
                prize_code: prizeCodeValue,
                spin_time: new Date().toISOString()
            };
            
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Google Apps Script
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxb1BENTJpJu9FG3IoGMRZZ-XaxfZ91aogf6WV-NJrsxE30vKb9NVdO5qvLKcr3gf_j/exec'; // Ø³ÙŠØªÙ… ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© 3
            
            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                setTimeout(() => {
                    loadingDiv.classList.remove('show');
                    resultDiv.classList.add('show');
                    spinButton.textContent = 'ğŸ¡ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ØºØ¯Ø§Ù‹';
                    spinButton.disabled = true;
                    isSpinning = false;
                }, 2000);
            })
            .catch(error => {
                console.error('Error:', error);
                loadingDiv.classList.remove('show');
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                spinButton.disabled = false;
                isSpinning = false;
            });
        }

        // ============ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ============
        window.onload = function() {
            drawWheel();
            
            spinButton.addEventListener('click', spinWheel);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ Ø¯Ø§Ø± Ø§Ù„ÙŠÙˆÙ…
            checkLastSpin();
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¢Ø®Ø± ØªØ¯ÙˆÙŠØ±
        function checkLastSpin() {
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ­Ù‚Ù‚ Ù…Ù† localStorage Ø£Ùˆ Ù…Ù† Ø®Ù„Ø§Ù„ API
            const lastSpin = localStorage.getItem(`lastSpin_${userId}`);
            if (lastSpin) {
                const lastSpinTime = new Date(lastSpin);
                const now = new Date();
                const hoursDiff = (now - lastSpinTime) / (1000 * 60 * 60);
                
                if (hoursDiff < 24) {
                    spinButton.disabled = true;
                    spinButton.textContent = 'â³ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯ÙˆØ± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ ' + Math.ceil(24 - hoursDiff) + ' Ø³Ø§Ø¹Ø©';
                    document.getElementById('userInfo').innerHTML += '<br><span style="color:#ffdd59">âš ï¸ Ù„Ù‚Ø¯ Ø¯Ø±Øª Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„</span>';
                }
            }
        }

        // Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„ØªØ¯ÙˆÙŠØ±
        function saveSpinTime() {
            localStorage.setItem(`lastSpin_${userId}`, new Date().toISOString());
        }
    </script>
</body>
</html>
