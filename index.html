<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¡ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ - EZIO</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Cairo',sans-serif; }
    body { background:linear-gradient(145deg,#1a0b2e 0%,#2d1a44 100%); min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; }
    .container { max-width:700px; width:100%; background:rgba(10,5,20,0.7); backdrop-filter:blur(10px); border:2px solid #8a2be2; border-radius:40px; padding:30px 20px; box-shadow:0 20px 40px rgba(138,43,226,0.3); text-align:center; }
    h1 { color:#fff; text-shadow:0 0 10px #b266ff,0 0 20px #8a2be2; margin-bottom:10px; font-size:2.2rem; }
    .sub { color:#c084fc; margin-bottom:25px; font-size:1.1rem; }
    .wheel-wrapper { position:relative; width:300px; height:300px; margin:20px auto; }
    canvas { width:100%; height:100%; display:block; border-radius:50%; box-shadow:0 0 0 8px #4b0082,0 0 0 12px #2e0854,0 20px 40px black; }
    .pointer { position:absolute; top:-15px; left:50%; transform:translateX(-50%); width:0; height:0; border-left:20px solid transparent; border-right:20px solid transparent; border-top:35px solid #ffd700; filter:drop-shadow(0 0 10px gold); z-index:10; }
    .info { margin:30px 0 20px; padding:15px; background:rgba(75,0,130,0.5); border-radius:20px; border:1px solid #b266ff; color:white; }
    .spin-btn { background:linear-gradient(45deg,#8a2be2,#4b0082); color:white; border:none; padding:16px 50px; font-size:1.5rem; font-weight:bold; border-radius:60px; cursor:pointer; transition:0.3s; box-shadow:0 10px 0 #2e0854,0 10px 30px #8a2be2; margin-bottom:20px; width:100%; max-width:300px; }
    .spin-btn:active { transform:translateY(10px); box-shadow:0 2px 0 #2e0854,0 10px 30px #8a2be2; }
    .spin-btn:disabled { opacity:0.6; transform:translateY(5px); box-shadow:0 5px 0 #2e0854; cursor:not-allowed; }
    .result { margin-top:25px; padding:20px; background:rgba(255,215,0,0.15); border-right:8px solid #ffd700; border-radius:15px; font-size:1.3rem; color:#fff; text-align:right; display:none; }
    .result.show { display:block; animation:fadeIn 0.5s; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .footer { color:#a78bfa; margin-top:20px; font-size:0.9rem; }
    a { color:#ffd700; text-decoration:none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¡ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h1>
    <div class="sub">EZIO BOOT â€¢ Ù…Ø±Ø© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©</div>
    <div class="wheel-wrapper">
      <canvas id="wheelCanvas" width="500" height="500"></canvas>
      <div class="pointer"></div>
    </div>
    <div id="statusMessage" class="info">ğŸ”„ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù‡Ù„ÙŠØªÙƒ...</div>
    <button class="spin-btn" id="spinButton" disabled>ğŸ² Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¯ÙˆÙŠØ±</button>
    <div id="resultBox" class="result"></div>
    <div class="footer">ğŸ•’ ÙƒÙ„ 24 Ø³Ø§Ø¹Ø© â€¢ Ø¬ÙˆØ§Ø¦Ø² Ø­ØµØ±ÙŠØ©<br><a href="https://t.me/EZIOBOOT" target="_blank">@EZIOBOOT</a></div>
  </div>

  <script>
    // --------------------------------------------
    // âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - ØºÙŠÙ‘Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§
    // --------------------------------------------
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzt275w-6auya3HthtS-k_5TOHNyPTdQ4o7LP6To2fC8jFLNzBLOXL_vGDSw7ADK1ufGg/exec";
    const WHEEL_BG_IMAGE = "https://i.postimg.cc/wB7MWQsq/IMG-20260129-003341-890.jpg";

    // --------------------------------------------
    // Ù…ØµÙÙˆÙØ© PRIZES Ù…ÙˆØ­Ø¯Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (7 Ø¬ÙˆØ§Ø¦Ø² ÙÙ‚Ø·)
    // --------------------------------------------
    const PRIZES = [
      { name: "5000",     value: 5000,    type: "fixed",   color: "#4B0082" },
      { name: "10000",    value: 10000,   type: "fixed",   color: "#000000" },
      { name: "5%",       value: 5,       type: "percent", color: "#6A0DAD" },
      { name: "100000",   value: 100000,  type: "fixed",   color: "#000000" },
      { name: "10%",      value: 10,      type: "percent", color: "#8A2BE2" },
      { name: "500000",   value: 500000,  type: "fixed",   color: "#000000" },
      { name: "1000000",  value: 1000000, type: "fixed",   color: "#9400D3" }
    ];

    // --------------------------------------------
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø¬Ù„Ø©
    // --------------------------------------------
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    let currentAngle = 0;
    let spinVelocity = 0;
    let targetAngle = 0;
    let isSpinning = false;
    let prizeResult = null; // Ø³ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± (ÙƒØ§Ø¦Ù† ÙƒØ§Ù…Ù„)
    let userId = null;

    // --------------------------------------------
    // Ø¯Ø§Ù„Ø© Ø°ÙƒÙŠØ© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© ÙÙŠ PRIZES
    // --------------------------------------------
    function findPrizeIndex(prizeData) {
      if (!prizeData) return -1;
      // 1. Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… (Ù…Ø¹ trim)
      let index = PRIZES.findIndex(p => p.name.trim() === prizeData.name?.trim());
      if (index !== -1) return index;
      // 2. Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© ÙˆØ§Ù„Ù†ÙˆØ¹
      index = PRIZES.findIndex(p => p.value === prizeData.value && p.type === prizeData.type);
      if (index !== -1) return index;
      // 3. Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† trim)
      index = PRIZES.findIndex(p => p.name === prizeData.name);
      return index;
    }

    // --------------------------------------------
    // Ø¯Ø§Ù„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© ØªØ­Øª Ø§Ù„Ø³Ù‡Ù…
    // --------------------------------------------
    function getPrizeUnderPointer() {
      const pointerAngle = -Math.PI / 2;
      let effectiveAngle = (pointerAngle - currentAngle + 2 * Math.PI) % (2 * Math.PI);
      const sliceAngle = (2 * Math.PI) / PRIZES.length;
      let index = Math.floor(effectiveAngle / sliceAngle);
      if (index >= PRIZES.length) index = 0;
      return PRIZES[index];
    }

    // --------------------------------------------
    // Ø±Ø³Ù… Ø§Ù„Ø¹Ø¬Ù„Ø©
    // --------------------------------------------
    function drawWheel(angle = 0) {
      const w = canvas.width, h = canvas.height;
      const cx = w/2, cy = h/2;
      const radius = Math.min(w, h)/2 - 10;
      ctx.clearRect(0,0,w,h);
      const bg = new Image();
      bg.src = WHEEL_BG_IMAGE;
      ctx.save();
      ctx.beginPath();
      ctx.arc(cx, cy, radius, 0, 2*Math.PI);
      ctx.clip();
      ctx.drawImage(bg, 0, 0, w, h);
      ctx.restore();

      const sliceAngle = (2 * Math.PI) / PRIZES.length;
      for (let i = 0; i < PRIZES.length; i++) {
        const start = i * sliceAngle + angle;
        const end = start + sliceAngle;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, radius, start, end);
        ctx.closePath();
        ctx.fillStyle = PRIZES[i].color;
        ctx.fill();
        ctx.strokeStyle = "rgba(255,255,255,0.3)";
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(start + sliceAngle/2);
        ctx.textAlign = "center";
        ctx.font = "bold 20px 'Cairo', sans-serif";
        ctx.fillStyle = "#FFF";
        ctx.shadowColor = "black";
        ctx.shadowBlur = 8;
        ctx.fillText(PRIZES[i].name, radius * 0.65, 10);
        ctx.restore();
      }

      ctx.beginPath();
      ctx.arc(cx, cy, radius * 0.15, 0, 2*Math.PI);
      ctx.fillStyle = "#2E0854";
      ctx.shadowBlur = 20;
      ctx.shadowColor = "#8A2BE2";
      ctx.fill();
      ctx.shadowBlur = 0;
    }

    // --------------------------------------------
    // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© - ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ prizeResult Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
    // --------------------------------------------
    function spinWheel() {
      if (isSpinning || !prizeResult) return;
      isSpinning = true;
      document.getElementById('spinButton').disabled = true;

      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© ÙÙŠ PRIZES
      const prizeIndex = findPrizeIndex(prizeResult);
      console.log("ğŸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±:", prizeResult);
      console.log("ğŸ” Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ ÙÙŠ PRIZES:", prizeIndex);

      if (prizeIndex === -1) {
        console.error("âŒ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ PRIZES!", prizeResult);
        alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        return;
      }

      const sliceAngle = (2 * Math.PI) / PRIZES.length;
      // Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªÙŠ ØªØ¬Ø¹Ù„ Ù…Ù†ØªØµÙ Ø§Ù„Ù‚Ø·Ø§Ø¹ ØªØ­Øª Ø§Ù„Ø³Ù‡Ù… ØªÙ…Ø§Ù…Ø§Ù‹
      const target = (prizeIndex * sliceAngle) + (sliceAngle / 2) - Math.PI / 2;
      const spins = 8 + Math.floor(Math.random() * 5);
      targetAngle = target + (spins * 2 * Math.PI);
      spinVelocity = 0.4;
      animateSpin();
    }

    // --------------------------------------------
    // Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ø¬Ù„Ø© Ù…Ø¹ Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚Ø³Ø±ÙŠ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
    // --------------------------------------------
    function animateSpin() {
      spinVelocity *= 0.97;
      currentAngle += spinVelocity;
      drawWheel(currentAngle);

      const distance = Math.abs(((targetAngle - currentAngle) % (2 * Math.PI) + 3 * Math.PI) % (2 * Math.PI) - Math.PI);

      if (spinVelocity < 0.001 && distance < 0.05) {
        isSpinning = false;
        currentAngle = targetAngle;
        drawWheel(currentAngle);

        // ---------- Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚Ø³Ø±ÙŠ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰) ----------
        const actualPrize = getPrizeUnderPointer();
        console.log(`ğŸ¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©: ${prizeResult.name}, ØªØ­Øª Ø§Ù„Ø³Ù‡Ù…: ${actualPrize.name}`);
        if (actualPrize.name !== prizeResult.name || actualPrize.value !== prizeResult.value) {
          console.warn("âš ï¸ ØªØµØ­ÙŠØ­ Ø§Ù„Ø¹Ø¬Ù„Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ - Ø¹Ø¯Ù… ØªØ·Ø§Ø¨Ù‚");
          const correctIndex = findPrizeIndex(prizeResult);
          if (correctIndex !== -1) {
            const sliceAngle = (2 * Math.PI) / PRIZES.length;
            currentAngle = (correctIndex * sliceAngle) + (sliceAngle / 2) - Math.PI / 2;
            drawWheel(currentAngle);
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            const afterFix = getPrizeUnderPointer();
            console.log(`âœ… Ø¨Ø¹Ø¯ Ø§Ù„ØªØµØ­ÙŠØ­: ØªØ­Øª Ø§Ù„Ø³Ù‡Ù… ${afterFix.name}`);
          }
        }
        // ------------------------------------------------

        showResult();
        return;
      }
      requestAnimationFrame(animateSpin);
    }

    // --------------------------------------------
    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    // --------------------------------------------
    function showResult() {
      const resultBox = document.getElementById('resultBox');
      let prizeText = '';
      if (prizeResult.type === 'percent') {
        prizeText = `ğŸ <b>${prizeResult.value}%</b> Ø±ØµÙŠØ¯ Ø¥Ø¶Ø§ÙÙŠ Ø¹Ù„Ù‰ Ø´Ø­Ù†ØªÙƒ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!`;
      } else {
        prizeText = `ğŸ’° <b>${prizeResult.value}</b> Ù†Ù‚Ø·Ø© ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ!`;
      }
      resultBox.innerHTML = `
        <div style="display:flex; align-items:center; gap:10px;">
          <span style="font-size:3rem;">ğŸ‰</span>
          <div>
            <h3 style="color:#FFD700; margin:0;">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h3>
            <p style="margin:5px 0 0; font-size:1.2rem;">${prizeText}</p>
          </div>
        </div>
      `;
      resultBox.classList.add('show');
    }

    // --------------------------------------------
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    // --------------------------------------------
    function getUserIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('user_id');
    }

    // --------------------------------------------
    // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Apps Script
    // --------------------------------------------
    async function checkEligibilityAndSpin() {
      if (!userId) {
        document.getElementById('statusMessage').innerHTML = 'âŒ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….';
        return;
      }
      document.getElementById('statusMessage').innerHTML = 'â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...';
      const url = `${APPS_SCRIPT_URL}?action=spin&user_id=${userId}`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        if (data.success) {
          prizeResult = data.prize; // Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„ÙƒØ§Ù…Ù„
          document.getElementById('statusMessage').innerHTML = 'âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù„Ø¹Ø¨! Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ¯ÙˆÙŠØ±.';
          document.getElementById('spinButton').disabled = false;
        } else {
          document.getElementById('statusMessage').innerHTML = data.message || 'âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¢Ù†.';
          if (data.remaining) {
            document.getElementById('statusMessage').innerHTML += `<br>ğŸ•’ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${data.remaining.toFixed(1)} Ø³Ø§Ø¹Ø©`;
          }
        }
      } catch (err) {
        console.error(err);
        document.getElementById('statusMessage').innerHTML = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·.';
      }
    }

    // --------------------------------------------
    // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØ¯ÙˆÙŠØ± Ø¨Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    // --------------------------------------------
    window.onload = async function() {
      userId = getUserIdFromUrl();
      if (!userId) {
        document.getElementById('statusMessage').innerHTML = 'âŒ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª.';
        return;
      }
      await checkEligibilityAndSpin();
      drawWheel();
      document.getElementById('spinButton').onclick = spinWheel;
    };
  </script>
</body>
</html>
